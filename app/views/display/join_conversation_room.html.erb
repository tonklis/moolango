<script type="text/javascript">
	var publisher;
	var stream;
	var session = TB.initSession('<%= @session %>');
	var publisherProperties = new Object();
	var api_key = '<%= @api_key %>';
	var token = '<%= @token %>';

	$(function(){

		createPusher('<%= ENV['PUSHER_KEY']%>', '<%= @session.to_s %>', '<%= Topic.find(@topic_id).name %>');
		$('#chat_field')[0].value="Type your message here...";

		publisherProperties.publishVideo = false;
		publisher = TB.initPublisher(api_key, 'myPublisherDiv', publisherProperties);

		connect();

		$('#slideImageDiv').css("background-image", "url(/assets/<%= @hints[0].thumbnail_url %>)");
	});	
</script>

<div class="row">
	<div class="span6">
		<div id="waitingDivGone" style="position:relative;">
			<div id="waitingDiv">
				<br />
				<p>Waiting for user to connect, please wait.</p>
				<%= image_tag "spinner.gif" %>
			</div>
			<div id="userDiv" style="align:center;">
				<p> <%=@origin_user.firstname%> </p>
			</div>
		</div>
	</div>
	<div class="span6">
		<div id="slideDiv">
		<%= form_tag('/interaction', :remote => true, :id => "new_interaction") do %>
				<%= hidden_field_tag :session, @session.to_s[12..23] %>
				<%= hidden_field_tag :origin, false %>
				<%= hidden_field_tag :next, false %>
				<%= hidden_field_tag :topic_id, @topic_id %>
				<%= hidden_field_tag :language_id, @language_id %>
				<%= hidden_field_tag :current_slide, @hints[0].id %>
			<div id="slideImageDiv">
				<%= submit_tag "Next", :onClick => "nextInteraction(true);", :class => "slideNextButton conversationButton" %>
				<%= submit_tag "Prev", :onClick => "nextInteraction(false);", :class => "slidePrevButton conversationButton" %>				
			</div>
			<div id="slideTextDiv">
				<div id="hint_text"><%= @hints[0].description %></div>
			</div>
		<% end %>
		</div>
	</div>
</div>

<div class="row">
	<div class="span6">
		<div id="toolBar">
			<div id="totalTimeBar">
				<div id="timeBar"></div>
				<div id="totalTimeTxt" style="position:absolute; color:white;"></div>
			</div>
			<div id="actionsDiv">
				<div id="endCallDiv">
					<%= form_tag('/interaction/end_call', :remote => true) do %>
						<%= submit_tag "End Call", :class => "conversationButton" %>
					<% end %>
				</div>
				<div id="reconnectDiv">
					<button type="button" class="conversationButton" onClick="reconnect();">Reconnect</button>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="span6">
		<div id="outerPublisherDiv">
			<div id="publisherDiv" style="position:relative;">
				<div id="myPublisherDiv"></div>
			</div>
		</div>
	</div>
	<div class="span6">
		<div id="chatDiv">
			<ul id="chat">
			</ul>
			<%= form_for Message.new, remote: true do |f| %>
				<%= f.text_field :content, :onclick => "$('#chat_field')[0].value='';", :id=>"chat_field" %>
				<%= f.hidden_field :session, :value => @session.to_s[0..11] %>
				<%= f.hidden_field :origin, :value => false, :id=>"origin_field"%>
				<%= f.submit "Send", :class => "conversationButton" %>
			<% end %>
		</div>
	</div>
</div>

<div class="modal hide fade" id="myModal">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" onclick="windowClose();">x</button>
		<h3>The call has ended</h3>
	</div>
	<div class="modal-body" style="text-align: center;">
		<p id="modal_message">Click the button to return to the homepage</p>
	</div>
	<div class="modal-footer" style="text-align: center;">
	</div>
</div>
